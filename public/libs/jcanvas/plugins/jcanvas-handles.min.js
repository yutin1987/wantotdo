/**
 * @license jCanvas Handles v14.10.03
 * Copyright 2013 Caleb Evans
 * Released under the MIT license
 */
!function($){function e(e){var n=e._method;return n===$.fn.drawRect||n===$.fn.drawEllipse||n===$.fn.drawImage}function n(e){var n=e._method;return n===$.fn.drawLine||n===$.fn.drawQuadratic||n===$.fn.drawBezier}function r(e,n,r,t){var a=$.extend({cursors:{mouseover:"grab",mousedown:"grabbing",mouseup:"grab"}},n.handle,{layer:!0,draggable:!0,x:n[r],y:n[t],_parent:n,_xProp:r,_yProp:t,fromCenter:!0,dragstart:function(e){$(this).triggerLayerEvent(e._parent,"handlestart")},drag:function(e){var n=e._parent;n[e._xProp]=e.x-n.x,n[e._yProp]=e.y-n.y,o(n),$(this).triggerLayerEvent(n,"handlemove")},dragstop:function(e){$(this).triggerLayerEvent(e._parent,"handlestop")},dragcancel:function(e){$(this).triggerLayerEvent(e._parent,"handlecancel")}});e.draw(a),n._handles.push(e.getLayer(-1))}function t(e,n,r,t){var a,i;-1===r&&-1===t||1===r&&1===t?i="nwse-resize":0!==r||-1!==t&&1!==t?-1!==r&&1!==r||0!==t?(1===r&&-1===t||-1===r&&1===t)&&(i="nesw-resize"):i="ew-resize":i="ns-resize",a=$.extend({cursors:{mouseover:i}},n.handle,{layer:!0,draggable:!0,x:n.x+r*n.width/2,y:n.y+t*n.height/2,_parent:n,_px:r,_py:t,fromCenter:!0,dragstart:function(e){$(this).triggerLayerEvent(e._parent,"handlestart")},drag:function(e){var n=e._parent;n.resizeFromCenter?(n.width+=e.dx*e._px*2,n.height+=e.dy*e._py*2,n.constrainProportions&&(0===e._py?n.height=n.width/n.aspectRatio:n.width=n.height*n.aspectRatio)):(n.width+=e.dx*e._px,n.height+=e.dy*e._py,n.constrainProportions&&(0===e._py?n.height=n.width/n.aspectRatio:(n.width=n.height*n.aspectRatio,e.dx=e.dy*n.aspectRatio*e._py*e._px)),0!==e._px&&(n.x+=e.dx/2),0!==e._py&&(n.y+=e.dy/2)),s(n),$(this).triggerLayerEvent(n,"handlemove")},dragstop:function(e){var n=e._parent;$(this).triggerLayerEvent(n,"handlestop")},dragcancel:function(e){var n=e._parent;$(this).triggerLayerEvent(n,"handlecancel")}}),e.draw(a),n._handles.push(e.getLayer(-1))}function a(e,n){var r=n.handlePlacement;null===n.aspectRatio&&0!==n.height&&(n.aspectRatio=n.width/n.height),("corners"===r||"both"===r)&&(t(e,n,-1,-1),t(e,n,1,-1),t(e,n,1,1),t(e,n,-1,1)),("sides"===r||"both"===r)&&(t(e,n,0,-1),t(e,n,1,0),t(e,n,0,1),t(e,n,-1,0)),n.guide&&d(e,n)}function i(e){var n=e._guide;n&&(n.x=e.x,n.y=e.y,n.width=e.width,n.height=e.height,n.fromCenter=e.fromCenter)}function d(e,n){var r,t;r=$.extend({},n.guide,{layer:!0,draggable:!1,type:"rectangle",handle:null}),e.addLayer(r),t=e.getLayer(-1),n._guide=t,e.moveLayer(t,-n._handles.length-1),i(n)}function h(e,n){var t,a,i,d;for(t in n)n.hasOwnProperty(t)&&(a=n[t],null!==t.match(/c?x(\d+)/gi)&&(i=t,d=t.replace("x","y"),r(e,n,i,d)));n.guide&&l(e,n)}function o(e){var n=e._handles,r=e._guides,t,a,i,d;if(e._method===$.fn.drawQuadratic){if(n&&(i=e._guide))for(a=0;a<n.length;a+=1)t=e._handles[a],i["x"+(a+1)]=t.x,i["y"+(a+1)]=t.y}else if(e._method===$.fn.drawBezier&&r)for(d=0;d<r.length;d+=1)if(i=r[d],n=i._handles,i&&n)for(a=0;a<n.length;a+=1)t=n[a],i["x"+(a+1)]=t.x,i["y"+(a+1)]=t.y}function l(e,n){var r=n._handles,t,a,i,d,h,l,s;if(s=$.extend({},n.guide,{layer:!0,draggable:!1,type:"line"}),n._method===$.fn.drawQuadratic)e.addLayer(s),n._guide=e.getLayer(-1),e.moveLayer(n._guide,-r.length-1);else if(n._method===$.fn.drawBezier)for(n._guides=[],h=0;h<r.length;h+=1)d=r[h],a=r[h+1],t=r[h-1],i=null,void 0!==a?0===d._xProp.indexOf("x")&&0===a._xProp.indexOf("cx")&&(i=a):void 0!==t&&0===t._xProp.indexOf("cx")&&0===d._xProp.indexOf("x")&&(i=t),null!==i&&(e.addLayer(s),l=e.getLayer(-1),l._handles=[d,i],n._guides.push(l),e.moveLayer(l,-r.length-1));o(n)}function s(e){var n,r;if(e._handles)for(r=0;r<e._handles.length;r+=1)n=e._handles[r],n.x=e.x+e.width/2*n._px,n.y=e.y+e.height/2*n._py;i(e)}function g(e){var n=e._handles,r,t;if(n)for(t=0;t<n.length;t+=1)r=n[t],r.x=e[r._xProp]+e.x,r.y=e[r._yProp]+e.y;o(e)}function _(r){var t=$(r.canvas);void 0===r._handles&&(r._handles=[]),e(r)?a(t,r):n(r)&&h(t,r)}$.extend($.jCanvas.defaults,{handle:null,guide:null,aspectRatio:null,resizeFromCenter:!0,constrainProportions:!1,handlePlacement:"corners",minWidth:0,minHeight:0}),$.extend($.jCanvas.eventHooks,{add:function(e){e.handle&&_(e)},remove:function(e){var n,r,t;if(e._handles){for(n=$(this),t=0;t<e._handles.length;t+=1)r=e._handles[t],n.removeLayer(r);e._handles.length=0}},change:function(r,t){var a,i,d;if(t.handle)_(r);else if(null===t.handle&&(a=$(this),r._handles)){for(d=0;d<r._handles.length;d+=1)i=r._handles[d],a.removeLayer(i);r._handles.length=0}e(r)?(void 0!==t.width||void 0!==t.height)&&s(r):n(r)&&g(r)},animate:function(r,t){e(r)?("width"===t.prop||"height"===t.prop||"x"===t.prop||"y"===t.prop)&&s(r):n(r)&&null!==t.prop.match(/^c?(x|y)(\d+)/gi)&&g(r)},drag:function(r){e(r)?s(r):n(r)&&g(r)}})}(jQuery);